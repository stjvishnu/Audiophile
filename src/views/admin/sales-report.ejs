<div class=" bg-black text-white p-4  md:p-6 lg:p-8">
  <div class="max-w-7xl mx-auto space-y-4">



        <!-- Header -->
        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3 rounded-[1.5rem] p-4 border border-white border-opacity-40">
          <h2 class="text-2xl sm:text-3xl font-bold">Sales Report</h2>
          <div class="flex flex-wrap gap-2">
            <button onclick="downloadReport('pdf')" class="group border bg-white text-black border-black px-4 py-2 rounded-lg hover:bg-black hover:text-white hover:border hover:border-white transition">
              <i class="fa-solid fa-file-pdf text-black group-hover:text-white" ></i> Download PDF
            </button>
            <button onclick="downloadReport('excel')" class="group border bg-white text-black border-black px-4 py-2 rounded-lg hover:bg-black hover:text-white hover:border hover:border-white transition">
              <i class="fa-solid fa-file-csv"></i> Download Excel
            </button>
          </div>
        </div>
    
        <!-- Filters -->
        <div class="bg-black text-white p-5  rounded-[1.5rem]  border border-white border-opacity-40">
          <div class="grid md:grid-cols-4 gap-4 items-end">
    
            <div >
              <label class="block mb-2">Range</label>
              <select id="selection" class="w-full bg-white text-black border rounded-lg px-3 py-2 outline-none ">
                <option value="">Select</option>
                <option>Daily</option>
                <option>Weekly</option>
                <option>Monthly</option>
                <option>Yearly</option>
                <option>Custom</option>
              </select>
            </div>
    
            <div>
              <label class="block mb-2">Start Date</label>
              <input id="startDate" value="" type="text" placeholder="DD/MM/YYYY" class="w-full bg-white text-black border rounded-lg px-3 py-2 outline-none ">
            </div>
    
            <div>
              <label class="block mb-2">End Date</label>
              <input id="endDate" value="" type="text" placeholder="DD/MM/YYYY" class="w-full bg-white text-black border rounded-lg px-3 py-2 outline-none ">
            </div>
    
            <div class="flex gap-2">
              <button id="applyBtn" class="flex-1 bg-white text-black px-4 py-2 rounded-lg hover:bg-black hover:text-white hover:border hover:border-white  transition">
                Apply
              </button>
              <button class="bg-gray-200 text-black px-4 py-2 rounded-lg hover:bg-gray-800 hover:text-white hover:border hover:border-white transition">
               <a href="/admin/sales-report">Clear</a> 
              </button>
            </div>
    
          </div>
        </div>
    
        <!-- Metrics -->
        <div class="grid sm:grid-cols-3 gap-4 ">
          <div class="bg-white text-black p-3 rounded-2xl flex justify-between">
            <span>Overall Sales Count</span>
            <span id="salesCount" class="font-bold"><%=locals.salesCount%></span>
          </div>
    
          <div class="bg-white text-black p-3 rounded-2xl flex justify-between">
            <span>Overall Order Amount</span>
            <span id="orderAmount" class="font-bold">₹<%=locals.orderAmount%></span>
          </div>
    
          <div class="bg-white text-black p-3 rounded-2xl flex justify-between">
            <span>Overall Discount</span>
            <span id="discountAmount" class="font-bold">₹<%=locals.discountAmount%></span>
          </div>
        </div>



    <!-- ================== DESKTOP TABLE (md and above) ================== -->
    <div class="hidden md:block">
      <div class="bg-black rounded-[2rem] border border-gray-800 overflow-x-auto text-white w-full">

        <table class="w-full border-collapse min-w-[900px] ">

          <thead>
            <tr class="border-b border-gray-800 text-sm sm:text-base ">
              <th class="p-3 text-left">NO</th>
              <th class="p-3 text-left">Order ID</th>
              <th class="p-3 text-left">User Name</th>
              <th class="p-3 text-left">Payment</th>
              <th class="p-3 text-left">Status</th>
              <th class="p-3 text-left">Products</th>
              <th class="p-3 text-left">subTotal</th>
              <th class="p-3 text-left">Discount</th>
              <th class="p-3 text-left">Shipping</th>
              <th class="p-3 text-left">Grand Total</th>
            </tr>
          </thead>

          <tbody id="orderContainer" class="text-sm sm:text-base">

           <% if(orders && orders.length>0) { %>
            <% orders.forEach((order,index)=>{ %>
            
            <tr class="border-b border-gray-800 hover:bg-[#222] transition"
                style="animation: slideIn 0.6s ease forwards; animation-delay:<%= index * 0.1 %>s; opacity:0;">

              <td class="p-3"><%= index+1 %></td>

              <td class="p-3 font-semibold"><%= order?.orderNumber %></td>

              <td class="p-3"><%= order?.userId?.firstName %></td>

              <td class="p-3 text-gray-300">
                 <%= order?.payment.method %>
              </td>

              <td class="p-3"><%= order?.orderStatus %> </td>

              <td class="p-3">
                <div class="flex flex-col gap-1.5">
                  <% order.items.forEach(item => { %>
                    <span class="inline-flex items-center gap-2 px-2 py-0.5 rounded-2xl text-xs
                                 bg-gray-100/30 text-black border border-gray-700">
                      <span class="font-medium"><%= item.productName %></span>
                      <span class="px-1.5 py-0.5 bg-black text-white text-[10px] rounded-2xl">
                        <%= item.productColor || '—' %>
                      </span>
                      <% if (item.quantity) { %>
                        <span class="px-1.5 py-0.5 bg-black rounded-2xl text-[10px] text-white">
                          <%= item.quantity %>
                        </span>
                      <% } %>
                      <span class="text-gray-500">× <%= item.quantity %></span>
                    </span>
                  <% }) %>
                </div>
              </td>
<!-- 
              <td class="p-3">
                <span class="bg-gray-100 text-black px-3 py-1 rounded-full text-xs">
                   new Date(order.createdAt).toLocaleDateString('en-IN') 
                </span>
              </td> -->

              <td class="p-3">
                <span class="bg-gray-100 text-black px-3 py-1 rounded-full text-xs">
                  <%= order?.subTotal %>
                </span>
              </td>

              <td class="p-3">
                <span class="bg-gray-100 text-black px-3 py-1 rounded-full text-xs">
                  ₹ <%=order?.discount %>
                </span>
              </td>

              <td class="p-3">
                <span class="bg-gray-100 text-black px-3 py-1 rounded-full text-xs">
                  ₹ <%=order?.deliveryCharge %>
                </span>
              </td>

              <td class="p-3">
                <span class="bg-gray-100 text-black px-3 py-1 rounded-full text-xs">
                  ₹ <%=order?.total %>
                </span>
              </td>

            </tr>
            <% }) %>
            <% } %>
          </tbody>
        </table>
      </div>
    </div>



    <!-- ================== MOBILE CARDS (below md) ================== -->
    <div class="md:hidden space-y-4 mt-6">
      <% orders.forEach((order,index)=>{ %>
      <div 
        class="bg-black border border-white/30 rounded-xl p-4 space-y-3 transform transition-all duration-500 hover:scale-[1.01]"
        style="animation: slideIn 0.5s ease-out forwards; animation-delay:<%=index*0.1%>s; opacity:0; transform:translateY(20px);">

        <div class="flex justify-between items-center text-gray-300 text-sm">
          <span>#<%= index+1 %></span>
          <span><%= new Date(order.createdAt).toLocaleDateString('en-IN')%></span>
        </div>

        <div class="text-lg font-semibold text-white">
          Order: <%= order?.orderNumber %>
        </div>

        <div class="text-gray-400">
          User: <span class="text-white"><%= order?.userId?.firstName %></span>
        </div>

        <div class="text-gray-400">
          Amount:
          <span class="text-white font-semibold">₹ <%= order?.total %></span>
        </div>

        <div class="flex items-center gap-2 mt-1">
          <span class="px-3 py-1 bg-gray-100 text-black rounded-xl text-xs">
            <%= order?.payment.method %>
          </span>

          <span class="px-3 py-1 bg-gray-100 text-black rounded-xl text-xs">
            <%= order?.orderStatus %>
          </span>
        </div>

        <button onclick="orderDetails('<%= order?._id %>')"
          class="w-full bg-white text-black py-2 rounded-lg font-semibold mt-2">
          View Details
        </button>

      </div>
      <% }) %>
    </div>



    <%-include('./partials/pagination.ejs') %>

  </div>
</div>


<style>
  @keyframes slideIn {
    from { opacity: 0; transform: translateY(15px); }
    to { opacity: 1; transform: translateY(0); }
  }
</style>


<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

<script src="/js/admin/sales-report-script.js"></script>
