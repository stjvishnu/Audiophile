// Pagination configuration
let currentPage = <%= typeof currentPage !== 'undefined' ? currentPage : 1 %>;
let totalPages = <%= typeof totalPages !== 'undefined' ? totalPages : 1 %>;
let itemsPerPage = <%= typeof itemsPerPage !== 'undefined' ? itemsPerPage : 8 %>;
let totalItems = <%= typeof totalItems !== 'undefined' ? totalItems : 0 %>;

function getVisiblePages() {
  const delta = 2;
  const range = [];
  const rangeWithDots = [];

  for (
    let i = Math.max(2, currentPage - delta);
    i <= Math.min(totalPages - 1, currentPage + delta);
    i++
  ) {
    range.push(i);
  }

  if (currentPage - delta > 2) {
    rangeWithDots.push(1, '...');
  } else {
    rangeWithDots.push(1);
  }

  rangeWithDots.push(...range);

  if (currentPage + delta < totalPages - 1) {
    rangeWithDots.push('...', totalPages);
  } else {
    rangeWithDots.push(totalPages);
  }

  return rangeWithDots;
}

function updatePagination() {
  const pageNumbersContainer = document.getElementById('pageNumbers');
  const prevBtn = document.getElementById('prevBtn');
  const nextBtn = document.getElementById('nextBtn');
  const pageInfo = document.getElementById('pageInfo');

  // Clear existing page numbers
  pageNumbersContainer.innerHTML = '';

  if (totalPages <= 1) {
    document.querySelector('.pagination-container').style.display = 'none';
    return;
  }

  const visiblePages = getVisiblePages();

  // Generate page number buttons
  visiblePages.forEach((page) => {
    if (page === '...') {
      const dots = document.createElement('span');
      dots.className = 'px-2 py-1 text-gray-400 text-sm';
      dots.textContent = '...';
      pageNumbersContainer.appendChild(dots);
    } else {
      const pageBtn = document.createElement('button');
      pageBtn.className = `
        page-btn relative px-3 sm:px-4 py-2 text-sm font-medium rounded-full transition-all duration-300
        ${currentPage === page
          ? 'bg-white text-black shadow-lg scale-110 page-btn-active'
          : 'bg-gray-100 bg-opacity-10 backdrop-blur-sm text-white border border-gray-600 hover:bg-opacity-20 hover:border-gray-400 hover:shadow-md'
        }
      `;
      
      if (currentPage === page) {
        pageBtn.innerHTML = `
          <div class="absolute inset-0 bg-white rounded-full animate-pulse opacity-30"></div>
          <span class="relative z-10">${page}</span>
        `;
      } else {
        pageBtn.innerHTML = `<span class="relative z-10">${page}</span>`;
      }
      
      pageBtn.onclick = () => changePage(page);
      pageNumbersContainer.appendChild(pageBtn);
    }
  });

  // Update button states
  prevBtn.disabled = currentPage === 1;
  nextBtn.disabled = currentPage === totalPages;

  // Update page info
  const startItem = (currentPage - 1) * itemsPerPage + 1;
  const endItem = Math.min(currentPage * itemsPerPage, totalItems);
  pageInfo.textContent = `Page ${currentPage} of ${totalPages}`;
}

function changePage(page) {
  if (page < 1 || page > totalPages || page === currentPage) {
    return;
  }

  currentPage = page;
  updatePagination();

  // Smooth scroll to top
  window.scrollTo({ top: 0, behavior: 'smooth' });

  // Trigger custom event for page change (you can listen to this in your main code)
  const event = new CustomEvent('pageChanged', { 
    detail: { 
      currentPage: currentPage, 
      totalPages: totalPages 
    } 
  });
  document.dispatchEvent(event);

  // You can add your own logic here to update the product list
  // For example, make an AJAX call to fetch new data
  console.log(`Changed to page ${page}`);
}

// Initialize pagination when the page loads
document.addEventListener('DOMContentLoaded', function() {
  updatePagination();
});

// Function to update pagination data from outside
function setPaginationData(newCurrentPage, newTotalPages, newItemsPerPage, newTotalItems) {
  currentPage = newCurrentPage;
  totalPages = newTotalPages;
  itemsPerPage = newItemsPerPage;
  totalItems = newTotalItems;
  updatePagination();
}